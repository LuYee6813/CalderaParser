try {if (Get-InstalledModule -Name Az.Resources -ErrorAction SilentlyContinue) { ; } else {Install-Module -Name Az.Resources -Force};  ;  Import-Module -Name Az.Resources; $PWord = ConvertTo-SecureString -String "p4sswd" -AsPlainText -Force; $Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList "jonh@contoso.com", $Pword; Connect-AzAccount -Credential $Credential; $sp = Get-AzADServicePrincipal | where-object {$_.DisplayName -eq "SuperSP"}; if ($sp -eq $null) { Write-Warning "Service Principal not found"; exit }; $subscription = Get-AzSubscription | where-object {$_.Name -eq "Azure subscription 1"} ; if ($subscription -eq $null) { Write-Warning "Subscription not found"; exit }; $role = Get-AzRoleDefinition | where-object {$_.Name -eq "Reader"}; if ($role -eq $null) { Write-Warning "Role not found"; exit }; New-AzRoleAssignment -ObjectId $sp.id -RoleDefinitionId $role.id -Scope /subscriptions/$subscription; Write-Host "Service Principal $($sp.DisplayName) was added to $($role.Name) role in subscriptions $($subscriptions.Name)"